/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**        \file  Appl.c
 *        \brief  Source file for Appl module.
 *
 *      \details  
 *
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/
#include "Port.h"
#include "IntCtrl.h"
#include "Timer.h"
#include "Led.h"
#include "Appl.h"


/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/
#define Enable_Global_Interrupt()    __asm("CPSIE I")
#define Disable_Global_Interrupt()   __asm("CPSID I")


#define TICK_TIME_BY_SECOND      1

/**********************************************************************************************************************
 *  LOCAL DATA 
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/
uint16 New_Tick_Count = 0;
uint8 New_Tick_Flag = 0;

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/
/******************************************************************************
* \Syntax          : void Appl_SetUp(void)        
* \Description     : Set drivers gonfigurations and start timer.                                    
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Reentrant                                             
* \Parameters (in) : None
* \Parameters (out): None                                                      
* \Return value:   : None                                  
*******************************************************************************/
void Appl_SetUp(void)
{
	Port_Init(&Port_Configuration);
	IntCtrl_init(&IntCtrl_Configuration);
	
	Enable_Global_Interrupt();
	
	Systick_setCallBack(Appl_NewTick);
	
	Systick_start(TICK_TIME_BY_SECOND);
	
	Led_setOn();
	
}



/******************************************************************************
* \Syntax          : void Appl_NewTick(void)        
* \Description     : Calculate timer tick counts.                                    
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Reentrant                                             
* \Parameters (in) : None
* \Parameters (out): None                                                      
* \Return value:   : None                                  
*******************************************************************************/
void Appl_NewTick(void)
{
	New_Tick_Count++;
	New_Tick_Flag= 1;
	
}

/******************************************************************************
* \Syntax          : void Led_Control(uint16 on_time, uint16 off_time)        
* \Description     : lights a LED for the given ON time, and dim it for the given OFF time.                                    
*                                                                             
* \Sync\Async      : Synchronous                                               
* \Reentrancy      : Reentrant                                             
* \Parameters (in) : on_time
                     off_time
* \Parameters (out): None                                                      
* \Return value:   : None                                  
*******************************************************************************/
void Appl_LedControl(uint16 on_time, uint16 off_time)
{
	uint16 total_time= on_time + off_time;
	while(1)
	{
			if(New_Tick_Flag == 1)
			{
				if(New_Tick_Count == on_time)
				{
					Led_setOff();
					New_Tick_Flag= 0;		      
				}

		    else if(New_Tick_Count == total_time)
				{
					Led_setOn();
		    	New_Tick_Flag= 0;
		    	New_Tick_Count= 0;
				}
			}

	}
		
}

/**********************************************************************************************************************
 *  END OF FILE: Appl.c
 *********************************************************************************************************************/
